<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<script>
"use strict";

const intl = new Intl.NumberFormat(
	"ja-JP", {style: "currency", currency: "JPY"}
);

document.addEventListener("DOMContentLoaded", () => {
	const calc = (a, b) => {
		const text = a.value;
		const matches = text.matchAll(/(?<operator>[+ ])(?<price>[\d\.]+)/g);

		let sum = 0;

		for (const match of matches) {
			if (match.groups.price.includes(".")) {
				continue;
			}

			const price = Number(match.groups.price);

			if (match.groups.operator === "+") {
				sum += price;
			} else {
				sum -= price;
			}
		}

		b.textContent = intl.format(-sum);
	};

	const resultP = document.querySelector("#result");
	const clearButton = document.querySelector("#clear");
	const pasteButton = document.querySelector("#paste");
	const textarea = document.querySelector("textarea");

	clearButton.addEventListener("click", () => {
		textarea.value = "";
		calc(textarea, resultP);
	});

	pasteButton.addEventListener("click", () => {
		navigator.clipboard.readText().then((text) => {
			 textarea.value = text;
			 calc(textarea, resultP);
		});
	});

	textarea.addEventListener("input", (event) => {
		calc(event.target, resultP);
	});

	calc(textarea, resultP);
});
</script>
</head>

<body style="font-family: sans-serif;">
<p style="font-size: xx-large;" id="result">n/a</p>
<p>
<input type="button" value="消去" id="clear">
<input type="button" value="貼り付け" id="paste">
</p>
<textarea rows="40" style="width: 50%;">
うまい棒5本 10 10 10 10 10
３色パン 150 (50.0+50.0+50.0)
ゲーム 8000 ポイント獲得+240 売却+5000
食事（予算より100円安かった場合） +100

↑は2860円になるのが正しい
</textarea>
</body>

</html>
